<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Manage Marks</title>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}" 
          rel="stylesheet">
</head>
<body>
<div class="container py-4">

    <h2 class="mb-4">Manage Marks</h2>

    <!-- Success Message -->
    <div th:if="${param.success}" class="alert alert-success" role="alert"
         th:text="${param.success}">
    </div>

    <!-- Add / Update Marks Form -->
    <form th:action="@{/results}" method="post" 
          class="row g-3 align-items-end mb-4">

        <!-- Student Dropdown -->
        <div class="col-md-3">
            <label class="form-label">Student</label>
            <select name="studentId" class="form-select" required>
                <option disabled selected>Select Student</option>
                <option th:each="s : ${students}"
                        th:value="${s.id}"
                        th:text="${s.name + ' (' + s.rollNumber + ')'}">
                </option>
            </select>
        </div>

        <!-- Subject Dropdown -->
        <div class="col-md-3">
            <label class="form-label">Subject</label>
            <select name="subjectId" class="form-select" required>
                <option disabled selected>Select Subject</option>
                <option th:each="sub : ${subjects}"
                        th:value="${sub.id}"
                        th:text="${sub.name}">
                </option>
            </select>
        </div>

        <!-- Exam Dropdown -->
        <div class="col-md-2">
            <label class="form-label">Exam</label>
            <select name="examId" class="form-select" required>
                <option disabled selected>Select Exam</option>
                <option th:each="e : ${exams}"
                        th:value="${e.id}"
                        th:text="${e.name}">
                </option>
            </select>
        </div>

        <!-- Marks Input -->
        <div class="col-md-2">
            <label class="form-label">Marks</label>
            <input type="number" name="marksObtained" class="form-control" required>
        </div>

        <div class="col-md-2">
            <button class="btn btn-warning w-100">Save Marks</button>
        </div>
    </form>

    <!-- Existing Results Table -->
    <h4>Existing Results</h4>
    <table class="table table-bordered mt-3">
        <thead>
        <tr>
            <th>Student</th>
            <th>Subject</th>
            <th>Exam</th>
            <th>Marks</th>
            <th>Grade</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="r : ${resultsList}">
            <td th:text="${r.student.name}"></td>
            <td th:text="${r.subject.name}"></td>
            <td th:text="${r.exam.name}"></td>
            <td th:text="${r.marks}"></td>
            <td th:text="${r.grade}"></td>

            <!-- Green for PASS / Red for FAIL -->
            <td>
                <span class="badge"
                      th:classappend="${r.status == 'PASS'} ? 'bg-success' : 'bg-danger'"
                      th:text="${r.status}">
                </span>
            </td>

            <td>
                <a th:href="@{|/results/edit/${r.id}|}"
                   class="btn btn-sm btn-primary">‚úè Edit</a>
            </td>
        </tr>
        </tbody>
    </table>

    <a th:href="@{/index}" class="btn btn-secondary mt-3">Home</a>

</div>
</body>
</html>
